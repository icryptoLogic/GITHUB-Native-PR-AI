<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>AI PR GITHUB Dashboard</title>
Â  <style>
Â  Â  :root {
Â  Â  Â  --bg: #0f172a;
Â  Â  Â  --card: #1e293b;
Â  Â  Â  --accent: #38bdf8;
Â  Â  Â  --text: #f1f5f9;
Â  Â  Â  --green: #4ade80; /* Added for low risk / merged */
Â  Â  Â  --red: #f87171; /* Added for high risk / closed */
Â  Â  Â  --yellow: #facc15; /* Added for open status */
Â  Â  }
Â  Â  * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, sans-serif; }
Â  Â  body { 
        background: var(--bg); 
        color: var(--text); 
        padding: 2rem; 
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
Â  Â  h1 { text-align: center; margin-bottom: 2rem; font-size: 2.5rem; color: var(--accent); }
Â  Â  .grid { 
        display: grid; 
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
        gap: 1.5rem; 
        width: 100%;
        max-width: 1200px;
    }
Â  Â  .card { 
        background: var(--card); 
        padding: 1.5rem; 
        border-radius: 1rem; 
        box-shadow: 0 8px 16px rgba(0,0,0,0.5); 
    }
Â  Â  .card p { margin-bottom: 0.5rem; }
    .card strong { color: var(--accent); margin-right: 0.5rem; }
Â  Â  .card h2 { font-size: 1.4rem; margin-bottom: 1rem; color: var(--accent); border-bottom: 2px solid rgba(56, 189, 248, 0.3); padding-bottom: 0.5rem; }
Â  Â  .btn { display: inline-block; background: var(--accent); color: var(--bg); padding: 0.6rem 1.2rem; border-radius: 0.5rem; text-decoration: none; margin-top: 1rem; font-weight: 700; transition: background 0.2s; }
    .btn:hover { background: #7dd3fc; }
Â  Â  footer { text-align: center; margin-top: 3rem; padding-top: 1rem; border-top: 1px solid var(--card); font-size: 0.9rem; opacity: 0.7; width: 100%; max-width: 1200px; }

    /* New status colors */
    .risk-low { color: var(--green); font-weight: 700; }
    .risk-high { color: var(--red); font-weight: 700; }
    .status-merged { color: var(--green); font-weight: 700; }
    .status-open { color: var(--yellow); font-weight: 700; }
    .status-closed { color: var(--red); font-weight: 700; }
Â  </style>
</head>
<body>
Â  <h1>AI PR GITHUB Dashboard</h1>

Â  <div class="grid">
Â  Â  <div class="card">
Â  Â  Â  <h2>Latest PR Summary</h2>
Â  Â  Â  <p id="prTitle">Loading...</p>
Â  Â  Â  <p><strong>Author:</strong> <span id="prAuthor">Loading...</span></p>
Â  Â  Â  <p><strong>Files/Changes:</strong> <span id="summary">Loading...</span></p>
Â  Â  Â  <a href="#" id="prLink" class="btn" target="_blank">View PR</a>
Â  Â  </div>

Â  Â  <div class="card">
Â  Â  Â  <h2>Metrics</h2>
Â  Â  Â  <p><strong>Risk Score:</strong> <span id="riskScore">Loading...</span></p>
Â  Â  Â  <p><strong>Bandit Issues:</strong> <span id="banditIssues">Loading...</span></p>
Â  Â  Â  <p><strong>Tests Failed:</strong> <span id="testsFailed">Loading...</span></p>
Â  Â  </div>

Â  Â  <div class="card">
Â  Â  Â  <h2>PR Status</h2>
Â  Â  Â  <p><strong>State:</strong> <span id="stateStatus">Loading...</span></p>
Â  Â  Â  <p><strong>Merged:</strong> <span id="mergedStatus">Loading...</span></p>
      <p><strong>Auto-Merge:</strong> <span id="autoMergeStatus">Loading...</span></p>
Â  Â  </div>
Â  </div>

Â  <footer>
Â  Â  Â© 2025 AI-PR-GITHUB | Built with â™¥ for GitHub Pages
Â  </footer>

Â  <script>
Â  Â  const dataUrl = "./dashboard.json";Â 
Â  Â  const repoBaseUrl = "https://github.com/icryptologic/GITHUB-Native-PR-AI/pull/";

Â  Â  async function loadMetrics() {
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(dataUrl);
Â  Â  Â  Â  if (!res.ok) throw new Error(`HTTP error: ${res.status}`);

Â  Â  Â  Â  const dataArray = await res.json();
Â  Â  Â  Â  if (!Array.isArray(dataArray) || dataArray.length === 0) throw new Error("No PR data");

Â  Â  Â  Â  // CORRECTED: Get the FIRST element (index 0) because the workflow is sorting newest first.
Â  Â  Â  Â  const latestPR = dataArray[0];

        // Helper functions for readability
        const getElement = (id) => document.getElementById(id);
        const setContent = (id, content) => getElement(id).textContent = content;
        const setClass = (id, className) => getElement(id).className = className;

Â  Â  Â  Â  // PR Details
Â  Â  Â  Â  setContent('prTitle', `#${latestPR.id} â€“ ${latestPR.title}`);
Â  Â  Â  Â  setContent('prAuthor', `@${latestPR.author}`);
Â  Â  Â  Â  // Combined files, additions, and deletions into one summary element
Â  Â  Â  Â  setContent('summary', `${latestPR.changed_files} files, +${latestPR.additions} / -${latestPR.deletions}`);
Â  Â  Â  Â  getElement('prLink').href = `${repoBaseUrl}${latestPR.id}`;
        getElement('prLink').textContent = `View PR #${latestPR.id}`;

Â  Â  Â  Â  // Metrics
        const riskScoreElement = getElement('riskScore');
Â  Â  Â  Â  riskScoreElement.textContent = `${latestPR.risk} / 100`;
        // Apply color based on risk score (using string to number conversion)
        const risk = parseInt(latestPR.risk);
        riskScoreElement.className = risk > 30 ? 'risk-high' : 'risk-low';
        
        // Updated IDs to match the new structure
Â  Â  Â  Â  setContent('banditIssues', latestPR.bandit || 0);
Â  Â  Â  Â  setContent('testsFailed', latestPR.tests_failed || 0);
Â  Â  Â  Â  
        // Status
        const mergedStatus = latestPR.merged === "true" ? "âœ… True" : "âŒ False";
        setContent('mergedStatus', mergedStatus);
        
        const stateStatusElement = getElement('stateStatus');
        const state = latestPR.state ? latestPR.state.toUpperCase() : 'N/A';
        stateStatusElement.textContent = state;
        if (state === 'OPEN') setClass('stateStatus', 'status-open');
        else if (state === 'CLOSED') setClass('stateStatus', 'status-closed');

        // Display Auto-Merge Status (Using the new field from the YAML file)
        const autoMerge = latestPR.auto_merged === "true" ? "ğŸŸ¢ ELIGIBLE" : "ğŸ”´ REQUIRES MANUAL REVIEW";
        setContent('autoMergeStatus', autoMerge);


Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.error("Dashboard error:", err);
Â  Â  Â  Â  document.getElementById('prTitle').textContent = "âš ï¸ Error fetching data";
        document.getElementById('prAuthor').textContent = "Check GitHub Actions logs.";
        document.getElementById('prLink').textContent = "Refresh Page";
        document.getElementById('prLink').href = "#";
Â  Â  Â  }
Â  Â  }

Â  Â  loadMetrics();
Â  </script>
</body>
</html>

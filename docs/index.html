<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI PR GITHUB Dashboard</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #1e293b;
      --accent: #38bdf8;
      --text: #f1f5f9;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, sans-serif; }
    body { background: var(--bg); color: var(--text); padding: 2rem; }
    h1 { text-align: center; margin-bottom: 2rem; font-size: 2rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 1.5rem; }
    .card { background: var(--card); padding: 1.5rem; border-radius: 1rem; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
    .card h2 { font-size: 1.25rem; margin-bottom: 0.75rem; color: var(--accent); }
    .btn { display: inline-block; background: var(--accent); color: #000; padding: 0.5rem 1rem; border-radius: 0.5rem; text-decoration: none; margin-top: 0.75rem; font-weight: 600; }
    footer { text-align: center; margin-top: 2rem; font-size: 0.9rem; opacity: 0.7; }
  </style>
</head>
<body>
  <h1>AI PR GITHUB Dashboard</h1>

  <div class="grid">
    <div class="card">
      <h2>Latest PR Summary</h2>
      <p id="prTitle">Loading...</p>
      <p><strong>Author:</strong> <span id="prAuthor">Loading...</span></p>
      <p><strong>Files/Changes:</strong> <span id="summary">Loading...</span></p>
      <a href="#" id="prLink" class="btn" target="_blank">View PR</a>
    </div>

    <div class="card">
      <h2>Metrics</h2>
      <p><strong>Risk Score:</strong> <span id="riskScore">Loading...</span></p>
      <p><strong>Bandit Issues:</strong> <span id="banditIssues">Loading...</span></p>
      <p><strong>Tests Failed:</strong> <span id="testsFailed">Loading...</span></p>
    </div>

    <div class="card">
      <h2>PR Status</h2>
      <p><strong>Merged:</strong> <span id="mergedStatus">Pending/N/A</span></p>
    </div>
  </div>

  <footer>
    © 2025 AI-PR-GITHUB | Built with ♥ for GitHub Pages
  </footer>

  <script>
    const dataUrl = "./dashboard.json"; 
    const repoBaseUrl = "https://github.com/icryptologic/GITHUB-Native-PR-AI/pull/";

    async function loadMetrics() {
      try {
        const res = await fetch(dataUrl);
        if (!res.ok) throw new Error(`HTTP error: ${res.status}`);

        const dataArray = await res.json();
        if (!Array.isArray(dataArray) || dataArray.length === 0) throw new Error("No PR data");

        const latestPR = dataArray[dataArray.length - 1];

        document.getElementById('prTitle').textContent = `#${latestPR.id} – ${latestPR.title}`;
        document.getElementById('prAuthor').textContent = `@${latestPR.author}`;
        document.getElementById('summary').textContent = `${latestPR.changed_files} files, +${latestPR.additions} / -${latestPR.deletions}`;
        document.getElementById('prLink').href = `${repoBaseUrl}${latestPR.id}`;
        document.getElementById('riskScore').textContent = `${latestPR.risk} / 100`;
        document.getElementById('banditIssues').textContent = latestPR.bandit || 0;
        document.getElementById('testsFailed').textContent = latestPR.tests_failed || 0;
        document.getElementById('mergedStatus').textContent = latestPR.merged || "Pending/N/A";
      } catch (err) {
        console.error("Dashboard error:", err);
        document.getElementById('prTitle').textContent = "⚠️ Error fetching data";
      }
    }

    loadMetrics();
  </script>
</body>
</html>
